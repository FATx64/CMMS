"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.getUnsupportedTargets = getUnsupportedTargets;
exports.default = exports.targetMetadata = void 0;

var _data = _interopRequireDefault(require("caniuse-db/fulldata-json/data-2.0.json"));

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }

function _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }

function _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }

// HACK: modern targets should be determined once at runtime
const targetMetadata = {
  targets: ['chrome', 'firefox', 'opera', 'safari', 'ie', 'edge', 'ios_saf', 'op_mini', 'android', 'bb', 'op_mob', 'and_chr', 'and_ff', 'ie_mob', 'and_uc', 'samsung', 'baidu', 'kaios']
};
exports.targetMetadata = targetMetadata;
const targetNameMappings = {
  chrome: 'Chrome',
  firefox: 'Firefox',
  opera: 'Opera',
  baidu: 'Baidu',
  and_qq: 'QQ Browser',
  safari: 'Safari',
  android: 'Android Browser',
  ie: 'IE',
  edge: 'Edge',
  ios_saf: 'iOS Safari',
  op_mini: 'Opera Mini',
  bb: 'Blackberry Browser',
  op_mob: 'Opera Mobile',
  and_chr: 'Android Chrome',
  and_ff: 'Android Firefox',
  ie_mob: 'IE Mobile',
  and_uc: 'Android UC Browser',
  samsung: 'Samsung Browser',
  kaios: 'KaiOS'
};
/**
 * Take a target's id and return it's full name by using `targetNameMappings`
 * ex. {target: and_ff, version: 40} => 'Android FireFox 40'
 */

function formatTargetNames(target) {
  const name = targetNameMappings[target.target] || target.target;
  return `${name} ${target.version}`;
}
/**
 * Check if a browser version is in the range format
 * ex. 10.0-10.2
 */


function versionIsRange(version) {
  return version.includes('-');
}
/**
 * Parse version from caniuse and compare with parsed version from browserslist.
 */


function compareRanges(targetVersion, statsVersion) {
  return targetVersion === parseFloat(statsVersion);
}
/*
 * Check the CanIUse database to see if targets are supported
 */


function isNotSupportedByCaniuse(node, {
  version,
  target,
  parsedVersion
}) {
  const {
    stats
  } = _data.default.data[node.caniuseId];
  if (!(target in stats)) return true;
  const targetStats = stats[target];

  if (versionIsRange(version)) {
    return Object.keys(targetStats).some(statsVersion => versionIsRange(statsVersion) && compareRanges(parsedVersion, statsVersion) ? !targetStats[statsVersion].includes('y') : false);
  } // @TODO: This assumes that all versions are included in the cainuse db. If this is incorrect,
  //        this will return false negatives To properly do this, we have to to range comparisons.
  //        Ex. given query for 50 and only version 40 exists in db records, return true


  if (!(version in targetStats)) return true;
  return targetStats[version] && !targetStats[version].includes('y');
}
/**
 * Return an array of all unsupported targets
 */


function getUnsupportedTargets(node, targets) {
  return targets.filter(target => isNotSupportedByCaniuse(node, target)).map(formatTargetNames);
}

const CanIUseProvider = [// new ServiceWorker()
{
  caniuseId: 'serviceworkers',
  astNodeType: 'NewExpression',
  object: 'ServiceWorker'
}, {
  caniuseId: 'serviceworkers',
  astNodeType: 'MemberExpression',
  object: 'navigator',
  property: 'serviceWorker'
}, // document.querySelector()
{
  caniuseId: 'queryselector',
  astNodeType: 'MemberExpression',
  object: 'document',
  property: 'querySelector'
}, // IntersectionObserver
{
  caniuseId: 'intersectionobserver',
  astNodeType: 'NewExpression',
  object: 'IntersectionObserver'
}, // ResizeObserver
{
  caniuseId: 'resizeobserver',
  astNodeType: 'NewExpression',
  object: 'ResizeObserver'
}, // PaymentRequest
{
  caniuseId: 'payment-request',
  astNodeType: 'NewExpression',
  object: 'PaymentRequest'
}, // Promises
{
  caniuseId: 'promises',
  astNodeType: 'NewExpression',
  object: 'Promise'
}, {
  caniuseId: 'promises',
  astNodeType: 'MemberExpression',
  object: 'Promise',
  property: 'resolve'
}, {
  caniuseId: 'promises',
  astNodeType: 'MemberExpression',
  object: 'Promise',
  property: 'all'
}, {
  caniuseId: 'promises',
  astNodeType: 'MemberExpression',
  object: 'Promise',
  property: 'race'
}, {
  caniuseId: 'promises',
  astNodeType: 'MemberExpression',
  object: 'Promise',
  property: 'reject'
}, // fetch
{
  caniuseId: 'fetch',
  astNodeType: 'CallExpression',
  object: 'fetch'
}, // document.currentScript()
{
  caniuseId: 'document-currentscript',
  astNodeType: 'MemberExpression',
  object: 'document',
  property: 'currentScript'
}, // URL
{
  caniuseId: 'url',
  astNodeType: 'NewExpression',
  object: 'URL'
}, // URLSearchParams
{
  caniuseId: 'urlsearchparams',
  astNodeType: 'NewExpression',
  object: 'URLSearchParams'
}, // performance.now()
{
  caniuseId: 'high-resolution-time',
  astNodeType: 'MemberExpression',
  object: 'performance',
  property: 'now'
}, {
  caniuseId: 'typedarrays',
  astNodeType: 'NewExpression',
  object: 'TypedArray'
}, {
  caniuseId: 'typedarrays',
  astNodeType: 'NewExpression',
  object: 'Int8Array'
}, {
  caniuseId: 'typedarrays',
  astNodeType: 'NewExpression',
  object: 'Uint8Array'
}, {
  caniuseId: 'typedarrays',
  astNodeType: 'NewExpression',
  object: 'Uint8ClampedArray'
}, {
  caniuseId: 'typedarrays',
  astNodeType: 'NewExpression',
  object: 'Int16Array'
}, {
  caniuseId: 'typedarrays',
  astNodeType: 'NewExpression',
  object: 'Uint16Array'
}, {
  caniuseId: 'typedarrays',
  astNodeType: 'NewExpression',
  object: 'Int32Array'
}, {
  caniuseId: 'typedarrays',
  astNodeType: 'NewExpression',
  object: 'Uint32Array'
}, {
  caniuseId: 'typedarrays',
  astNodeType: 'NewExpression',
  object: 'Float32Array'
}, {
  caniuseId: 'typedarrays',
  astNodeType: 'NewExpression',
  object: 'Float64Array'
}].map(rule => _objectSpread({}, rule, {
  getUnsupportedTargets,
  id: rule.property ? `${rule.object}.${rule.property}` : rule.object,
  protoChainId: rule.property ? `${rule.object}.${rule.property}` : rule.object,
  protoChain: rule.property ? [rule.object, rule.property] : [rule.object]
}));
var _default = CanIUseProvider;
exports.default = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9wcm92aWRlcnMvQ2FuSVVzZVByb3ZpZGVyLmpzIl0sIm5hbWVzIjpbInRhcmdldE1ldGFkYXRhIiwidGFyZ2V0cyIsInRhcmdldE5hbWVNYXBwaW5ncyIsImNocm9tZSIsImZpcmVmb3giLCJvcGVyYSIsImJhaWR1IiwiYW5kX3FxIiwic2FmYXJpIiwiYW5kcm9pZCIsImllIiwiZWRnZSIsImlvc19zYWYiLCJvcF9taW5pIiwiYmIiLCJvcF9tb2IiLCJhbmRfY2hyIiwiYW5kX2ZmIiwiaWVfbW9iIiwiYW5kX3VjIiwic2Ftc3VuZyIsImthaW9zIiwiZm9ybWF0VGFyZ2V0TmFtZXMiLCJ0YXJnZXQiLCJuYW1lIiwidmVyc2lvbiIsInZlcnNpb25Jc1JhbmdlIiwiaW5jbHVkZXMiLCJjb21wYXJlUmFuZ2VzIiwidGFyZ2V0VmVyc2lvbiIsInN0YXRzVmVyc2lvbiIsInBhcnNlRmxvYXQiLCJpc05vdFN1cHBvcnRlZEJ5Q2FuaXVzZSIsIm5vZGUiLCJwYXJzZWRWZXJzaW9uIiwic3RhdHMiLCJjYW5pdXNlUmVjb3JkcyIsImRhdGEiLCJjYW5pdXNlSWQiLCJ0YXJnZXRTdGF0cyIsIk9iamVjdCIsImtleXMiLCJzb21lIiwiZ2V0VW5zdXBwb3J0ZWRUYXJnZXRzIiwiZmlsdGVyIiwibWFwIiwiQ2FuSVVzZVByb3ZpZGVyIiwiYXN0Tm9kZVR5cGUiLCJvYmplY3QiLCJwcm9wZXJ0eSIsInJ1bGUiLCJpZCIsInByb3RvQ2hhaW5JZCIsInByb3RvQ2hhaW4iXSwibWFwcGluZ3MiOiI7Ozs7Ozs7O0FBRUE7Ozs7Ozs7Ozs7QUFrQkE7QUFDTyxNQUFNQSxjQUE4QixHQUFHO0FBQzVDQyxFQUFBQSxPQUFPLEVBQUUsQ0FDUCxRQURPLEVBRVAsU0FGTyxFQUdQLE9BSE8sRUFJUCxRQUpPLEVBS1AsSUFMTyxFQU1QLE1BTk8sRUFPUCxTQVBPLEVBUVAsU0FSTyxFQVNQLFNBVE8sRUFVUCxJQVZPLEVBV1AsUUFYTyxFQVlQLFNBWk8sRUFhUCxRQWJPLEVB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TUFBTSxFQUFFO0FBSFYsQ0F2SW1DLEVBNEluQztBQUNFVixFQUFBQSxTQUFTLEVBQUUsYUFEYjtBQUVFUyxFQUFBQSxXQUFXLEVBQUUsZUFGZjtBQUdFQyxFQUFBQSxNQUFNLEVBQUU7QUFIVixDQTVJbUMsRUFpSm5DO0FBQ0VWLEVBQUFBLFNBQVMsRUFBRSxhQURiO0FBRUVTLEVBQUFBLFdBQVcsRUFBRSxlQUZmO0FBR0VDLEVBQUFBLE1BQU0sRUFBRTtBQUhWLENBakptQyxFQXNKbkNILEdBdEptQyxDQXNKL0JLLElBQUksc0JBQ0xBLElBREs7QUFFUlAsRUFBQUEscUJBRlE7QUFHUlEsRUFBQUEsRUFBRSxFQUFFRCxJQUFJLENBQUNELFFBQUwsR0FBaUIsR0FBRUMsSUFBSSxDQUFDRixNQUFPLElBQUdFLElBQUksQ0FBQ0QsUUFBUyxFQUFoRCxHQUFvREMsSUFBSSxDQUFDRixNQUhyRDtBQUlSSSxFQUFBQSxZQUFZLEVBQUVGLElBQUksQ0FBQ0QsUUFBTCxHQUFpQixHQUFFQyxJQUFJLENBQUNGLE1BQU8sSUFBR0UsSUFBSSxDQUFDRCxRQUFTLEVBQWhELEdBQW9EQyxJQUFJLENBQUNGLE1BSi9EO0FBS1JLLEVBQUFBLFVBQVUsRUFBRUgsSUFBSSxDQUFDRCxRQUFMLEdBQWdCLENBQUNDLElBQUksQ0FBQ0YsTUFBTixFQUFjRSxJQUFJLENBQUNELFFBQW5CLENBQWhCLEdBQStDLENBQUNDLElBQUksQ0FBQ0YsTUFBTjtBQUxuRCxFQXRKMkIsQ0FBckM7ZUE4SmVGLGUiLCJzb3VyY2VzQ29udGVudCI6WyIvLyBAZmxvd1xuLy8gJEZsb3dGaXhNZTogRmxvdyBpbXBvcnQgZXJyb3JcbmltcG9ydCBjYW5pdXNlUmVjb3JkcyBmcm9tICdjYW5pdXNlLWRiL2Z1bGxkYXRhLWpzb24vZGF0YS0yLjAuanNvbic7XG5pbXBvcnQgdHlwZSB7IE5vZGUsIFRhcmdldHMsIFRhcmdldCB9IGZyb20gJy4uL0xpbnRUeXBlcyc7XG5cbnR5cGUgVGFyZ2V0TWV0YWRhdGEgPSB7XG4gIC8vIFRoZSBsaXN0IG9mIHRhcmdldHMgc3VwcG9ydGVkIGJ5IHRoZSBwcm92aWRlclxuICB0YXJnZXRzOiBUYXJnZXRzXG59O1xuXG50eXBlIENhbklVc2VTdGF0cyA9IHtcbiAgW2Jyb3dzZXI6IHN0cmluZ106IHtcbiAgICBbdmVyc2lvbjogc3RyaW5nXTogc3RyaW5nXG4gIH1cbn07XG5cbnR5cGUgQ2FuSVVzZVJlY29yZHMgPSB7XG4gIGRhdGE6IENhbklVc2VTdGF0c1xufTtcblxuLy8gSEFDSzogbW9kZXJuIHRhcmdldHMgc2hvdWxkIGJlIGRldGVybWluZWQgb25jZSBhdCBydW50aW1lXG5leHBvcnQgY29uc3QgdGFyZ2V0TWV0YWRhdGE6IFRhcmdldE1ldGFkYXRhID0ge1xuICB0YXJnZXRzOiBbXG4gICAgJ2Nocm9tZScsXG4gICAgJ2ZpcmVmb3gnLFxuICAgICdvcGVyYScsXG4gICAgJ3NhZmFyaScsXG4gICAgJ2llJyxcbiAgICAnZWRnZScsXG4gICAgJ2lvc19zYWYnLFxuICAgICdvcF9taW5pJyxcbiAgICAnYW5kcm9pZCcsXG4gICAgJ2JiJyxcbiAgICAnb3BfbW9iJyxcbiAgICAnYW5kX2NocicsXG4gICAgJ2FuZF9mZicsXG4gICAgJ2llX21vYicsXG4gICAgJ2FuZF91YycsXG4gICAgJ3NhbXN1bmcnLFxuICAgICdiYWlkdScsXG4gICAgJ2thaW9zJ1xuICBdXG59O1xuXG5jb25zdCB0YXJnZXROYW1lTWFwcGluZ3MgPSB7XG4gIGNocm9tZTogJ0Nocm9tZScsXG4gIGZpcmVmb3g6ICdGaXJlZm94JyxcbiAgb3BlcmE6ICdPcGVyYScsXG4gIGJhaWR1OiAnQmFpZHUnLFxuICBhbmRfcXE6ICdRUSBCcm93c2VyJyxcbiAgc2FmYXJpOiAnU2FmYXJpJyxcbiAgYW5kcm9pZDogJ0FuZHJvaWQgQnJvd3NlcicsXG4gIGllOiAnSUUnLFxuICBlZGdlOiAnRWRnZScsXG4gIGlvc19zYWY6ICdpT1MgU2FmYXJpJyxcbiAgb3BfbWluaTogJ09wZXJhIE1pbmknLFxuICBiYjogJ0JsYWNrYmVycnkgQnJvd3NlcicsXG4gIG9wX21vYjogJ09wZXJhIE1vYmlsZScsXG4gIGFuZF9jaHI6ICdBbmRyb2lkIENocm9tZScsXG4gIGFuZF9mZjogJ0FuZHJvaWQgRmlyZWZveCcsXG4gIGllX21vYjogJ0lFIE1vYmlsZScsXG4gIGFuZF91YzogJ0FuZHJvaWQgVUMgQnJvd3NlcicsXG4gIHNhbXN1bmc6ICdTYW1zdW5nIEJyb3dzZXInLFxuICBrYWlvczogJ0thaU9TJ1xufTtcblxuLyoqXG4gKiBUYWtlIGEgdGFyZ2V0J3MgaWQgYW5kIHJldHVybiBpdCdzIGZ1bGwgbmFtZSBieSB1c2luZyBgdGFyZ2V0TmFtZU1hcHBpbmdzYFxuICogZXguIHt0YXJnZXQ6IGFuZF9mZiwgdmVyc2lvbjogNDB9ID0+ICdBbmRyb2lkIEZpcmVGb3ggNDAnXG4gKi9cbmZ1bmN0aW9uIGZvcm1hdFRhcmdldE5hbWVzKHRhcmdldDogVGFyZ2V0KTogc3RyaW5nIHtcbiAgY29uc3QgbmFtZSA9IHRhcmdldE5hbWVNYXBwaW5nc1t0YXJnZXQudGFyZ2V0XSB8fCB0YXJnZXQudGFyZ2V0O1xuICByZXR1cm4gYCR7bmFtZX0gJHt0YXJnZXQudmVyc2lvbn1gO1xufVxuXG4vKipcbiAqIENoZWNrIGlmIGEgYnJvd3NlciB2ZXJzaW9uIGlzIGluIHRoZSByYW5nZSBmb3JtYXRcbiAqIGV4LiAxMC4wLTEwLjJcbiAqL1xuZnVuY3Rpb24gdmVyc2lvbklzUmFuZ2UodmVyc2lvbjogc3RyaW5nKTogYm9vbGVhbiB7XG4gIHJldHVybiB2ZXJzaW9uLmluY2x1ZGVzKCctJyk7XG59XG5cbi8qKlxuICogUGFyc2UgdmVyc2lvbiBmcm9tIGNhbml1c2UgYW5kIGNvbXBhcmUgd2l0aCBwYXJzZWQgdmVyc2lvbiBmcm9tIGJyb3dzZXJzbGlzdC5cbiAqL1xuZnVuY3Rpb24gY29tcGFyZVJhbmdlcyh0YXJnZXRWZXJzaW9uOiBudW1iZXIsIHN0YXRzVmVyc2lvbjogc3RyaW5nKTogYm9vbGVhbiB7XG4gIHJldHVybiB0YXJnZXRWZXJzaW9uID09PSBwYXJzZUZsb2F0KHN0YXRzVmVyc2lvbik7XG59XG5cbi8qXG4gKiBDaGVjayB0aGUgQ2FuSVVzZSBkYXRhYmFzZSB0byBzZWUgaWYgdGFyZ2V0cyBhcmUgc3VwcG9ydGVkXG4gKi9cbmZ1bmN0aW9uIGlzTm90U3VwcG9ydGVkQnlDYW5pdXNlKFxuICBub2RlOiBOb2RlLFxuICB7IHZlcnNpb24sIHRhcmdldCwgcGFyc2VkVmVyc2lvbiB9OiBUYXJnZXRcbik6IGJvb2xlYW4ge1xuICBjb25zdCB7IHN0YXRzIH0gPSAoY2FuaXVzZVJlY29yZHM6IENhbklVc2VSZWNvcmRzKS5kYXRhW25vZGUuY2FuaXVzZUlkXTtcblxuICBpZiAoISh0YXJnZXQgaW4gc3RhdHMpKSByZXR1cm4gdHJ1ZTtcbiAgY29uc3QgdGFyZ2V0U3RhdHMgPSBzdGF0c1t0YXJnZXRdO1xuXG4gIGlmICh2ZXJzaW9uSXNSYW5nZSh2ZXJzaW9uKSkge1xuICAgIHJldHVybiBPYmplY3Qua2V5cyh0YXJnZXRTdGF0cykuc29tZSgoc3RhdHNWZXJzaW9uOiBzdHJpbmcpOiBib29sZWFuID0+XG4gICAgICB2ZXJzaW9uSXNSYW5nZShzdGF0c1ZlcnNpb24pICYmIGNvbXBhcmVSYW5nZXMocGFyc2VkVmVyc2lvbiwgc3RhdHNWZXJzaW9uKVxuICAgICAgICA/ICF0YXJnZXRTdGF0c1tzdGF0c1ZlcnNpb25dLmluY2x1ZGVzKCd5JylcbiAgICAgICAgOiBmYWxzZVxuICAgICk7XG4gIH1cblxuICAvLyBAVE9ETzogVGhpcyBhc3N1bWVzIHRoYXQgYWxsIHZlcnNpb25zIGFyZSBpbmNsdWRlZCBpbiB0aGUgY2FpbnVzZSBkYi4gSWYgdGhpcyBpcyBpbmNvcnJlY3QsXG4gIC8vICAgICAgICB0aGlzIHdpbGwgcmV0dXJuIGZhbHNlIG5lZ2F0aXZlcyBUbyBwcm9wZXJseSBkbyB0aGlzLCB3ZSBoYXZlIHRvIHRvIHJhbmdlIGNvbXBhcmlzb25zLlxuICAvLyAgICAgICAgRXguIGdpdmVuIHF1ZXJ5IGZvciA1MCBhbmQgb25seSB2ZXJzaW9uIDQwIGV4aXN0cyBpbiBkYiByZWNvcmRzLCByZXR1cm4gdHJ1ZVxuICBpZiAoISh2ZXJzaW9uIGluIHRhcmdldFN0YXRzKSkgcmV0dXJuIHRydWU7XG5cbiAgcmV0dXJuIHRhcmdldFN0YXRzW3ZlcnNpb25dICYmICF0YXJnZXRTdGF0c1t2ZXJzaW9uXS5pbmNsdWRlcygneScpO1xufVxuXG4vKipcbiAqIFJldHVybiBhbiBhcnJheSBvZiBhbGwgdW5zdXBwb3J0ZWQgdGFyZ2V0c1xuICovXG5leHBvcnQgZnVuY3Rpb24gZ2V0VW5zdXBwb3J0ZWRUYXJnZXRzKFxuICBub2RlOiBOb2RlLFxuICB0YXJnZXRzOiBUYXJnZXRzXG4pOiBBcnJheTxzdHJpbmc+IHtcbiAgcmV0dXJuIHRhcmdldHNcbiAgICAuZmlsdGVyKHRhcmdldCA9PiBpc05vdFN1cHBvcnRlZEJ5Q2FuaXVzZShub2RlLCB0YXJnZXQpKVxuICAgIC5tYXAoZm9ybWF0VGFyZ2V0TmFtZXMpO1xufVxuXG5jb25zdCBDYW5JVXNlUHJvdmlkZXI6IEFycmF5PE5vZGU+ID0gW1xuICAvLyBuZXcgU2VydmljZVdvcmtlcigpXG4gIHtcbiAgICBjYW5pdXNlSWQ6ICdzZXJ2aWNld29ya2VycycsXG4gICAgYXN0Tm9kZVR5cGU6ICdOZXdFeHByZXNzaW9uJyxcbiAgICBvYmplY3Q6ICdTZXJ2aWNlV29ya2VyJ1xuICB9LFxuICB7XG4gICAgY2FuaXVzZUlkOiAnc2VydmljZXdvcmtlcnMnLFxuICAgIGFzdE5vZGVUeXBlOiAnTWVtYmVyRXhwcmVzc2lvbicsXG4gICAgb2JqZWN0OiAnbmF2aWdhdG9yJyxcbiAgICBwcm9wZXJ0eTogJ3NlcnZpY2VXb3JrZXInXG4gIH0sXG4gIC8vIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoKVxuICB7XG4gICAgY2FuaXVzZUlkOiAncXVlcnlzZWxlY3RvcicsXG4gICAgYXN0Tm9kZVR5cGU6ICdNZW1iZXJFeHByZXNzaW9uJyxcbiAgICBvYmplY3Q6ICdkb2N1bWVudCcsXG4gICAgcHJvcGVydHk6ICdxdWVyeVNlbGVjdG9yJ1xuICB9LFxuICAvLyBJbnRlcnNlY3Rpb25PYnNlcnZlclxuICB7XG4gICAgY2FuaXVzZUlkOiAnaW50ZXJzZWN0aW9ub2JzZXJ2ZXInLFxuICAgIGFzdE5vZGVUeXBlOiAnTmV3RXhwcmVzc2lvbicsXG4gICAgb2JqZWN0OiAnSW50ZXJzZWN0aW9uT2JzZXJ2ZXInXG4gIH0sXG4gIC8vIFJlc2l6ZU9ic2VydmVyXG4gIHtcbiAgICBjYW5pdXNlSWQ6ICdyZXNpemVvYnNlcnZlcicsXG4gICAgYXN0Tm9kZVR5cGU6ICdOZXdFeHByZXNzaW9uJyxcbiAgICBvYmplY3Q6ICdSZXNpemVPYnNlcnZlcidcbiAgfSxcbiAgLy8gUGF5bWVudFJlcXVlc3RcbiAge1xuICAgIGNhbml1c2VJZDogJ3BheW1lbnQtcmVxdWVzdCcsXG4gICAgYXN0Tm9kZVR5cGU6ICdOZXdFeHByZXNzaW9uJyxcbiAgICBvYmplY3Q6ICdQYXltZW50UmVxdWVzdCdcbiAgfSxcbiAgLy8gUHJvbWlzZXNcbiAge1xuICAgIGNhbml1c2VJZDogJ3Byb21pc2VzJyxcbiAgICBhc3ROb2RlVHlwZTogJ05ld0V4cHJlc3Npb24nLFxuICAgIG9iamVjdDogJ1Byb21pc2UnXG4gIH0sXG4gIHtcbiAgICBjYW5pdXNlSWQ6ICdwcm9taXNlcycsXG4gICAgYXN0Tm9kZVR5cGU6ICdNZW1iZXJFeHByZXNzaW9uJyxcbiAgICBvYmplY3Q6ICdQcm9taXNlJyxcbiAgICBwcm9wZXJ0eTogJ3Jlc29sdmUnXG4gIH0sXG4gIHtcbiAgICBjYW5pdXNlSWQ6ICdwcm9taXNlcycsXG4gICAgYXN0Tm9kZVR5cGU6ICdNZW1iZXJFeHByZXNzaW9uJyxcbiAgICBvYmplY3Q6ICdQcm9taXNlJyxcbiAgICBwcm9wZXJ0eTogJ2FsbCdcbiAgfSxcbiAge1xuICAgIGNhbml1c2VJZDogJ3Byb21pc2VzJyxcbiAgICBhc3ROb2RlVHlwZTogJ01lbWJlckV4cHJlc3Npb24nLFxuICAgIG9iamVjdDogJ1Byb21pc2UnLFxuICAgIHByb3BlcnR5OiAncmFjZSdcbiAgfSxcbiAge1xuICAgIGNhbml1c2VJZDogJ3Byb21pc2VzJyxcbiAgICBhc3ROb2RlVHlwZTogJ01lbWJlckV4cHJlc3Npb24nLFxuICAgIG9iamVjdDogJ1Byb21pc2UnLFxuICAgIHByb3BlcnR5OiAncmVqZWN0J1xuICB9LFxuICAvLyBmZXRjaFxuICB7XG4gICAgY2FuaXVzZUlkOiAnZmV0Y2gnLFxuICAgIGFzdE5vZGVUeXBlOiAnQ2FsbEV4cHJlc3Npb24nLFxuICAgIG9iamVjdDogJ2ZldGNoJ1xuICB9LFxuICAvLyBkb2N1bWVudC5jdXJyZW50U2NyaXB0KClcbiAge1xuICAgIGNhbml1c2VJZDogJ2RvY3VtZW50LWN1cnJlbnRzY3JpcHQnLFxuICAgIGFzdE5vZGVUeXBlOiAnTWVtYmVyRXhwcmVzc2lvbicsXG4gICAgb2JqZWN0OiAnZG9jdW1lbnQnLFxuICAgIHByb3BlcnR5OiAnY3VycmVudFNjcmlwdCdcbiAgfSxcbiAgLy8gVVJMXG4gIHtcbiAgICBjYW5pdXNlSWQ6ICd1cmwnLFxuICAgIGFzdE5vZGVUeXBlOiAnTmV3RXhwcmVzc2lvbicsXG4gICAgb2JqZWN0OiAnVVJMJ1xuICB9LFxuICAvLyBVUkxTZWFyY2hQYXJhbXNcbiAge1xuICAgIGNhbml1c2VJZDogJ3VybHNlYXJjaHBhcmFtcycsXG4gICAgYXN0Tm9kZVR5cGU6ICdOZXdFeHByZXNzaW9uJyxcbiAgICBvYmplY3Q6ICdVUkxTZWFyY2hQYXJhbXMnXG4gIH0sXG4gIC8vIHBlcmZvcm1hbmNlLm5vdygpXG4gIHtcbiAgICBjYW5pdXNlSWQ6ICdoaWdoLXJlc29sdXRpb24tdGltZScsXG4gICAgYXN0Tm9kZVR5cGU6ICdNZW1iZXJFeHByZXNzaW9uJyxcbiAgICBvYmplY3Q6ICdwZXJmb3JtYW5jZScsXG4gICAgcHJvcGVydHk6ICdub3cnXG4gIH0sXG4gIHtcbiAgICBjYW5pdXNlSWQ6ICd0eXBlZGFycmF5cycsXG4gICAgYXN0Tm9kZVR5cGU6ICdOZXdFeHByZXNzaW9uJyxcbiAgICBvYmplY3Q6ICdUeXBlZEFycmF5J1xuICB9LFxuICB7XG4gICAgY2FuaXVzZUlkOiAndHlwZWRhcnJheXMnLFxuICAgIGFzdE5vZGVUeXBlOiAnTmV3RXhwcmVzc2lvbicsXG4gICAgb2JqZWN0OiAnSW50OEFycmF5J1xuICB9LFxuICB7XG4gICAgY2FuaXVzZUlkOiAndHlwZWRhcnJheXMnLFxuICAgIGFzdE5vZGVUeXBlOiAnTmV3RXhwcmVzc2lvbicsXG4gICAgb2JqZWN0OiAnVWludDhBcnJheSdcbiAgfSxcbiAge1xuICAgIGNhbml1c2VJZDogJ3R5cGVkYXJyYXlzJyxcbiAgICBhc3ROb2RlVHlwZTogJ05ld0V4cHJlc3Npb24nLFxuICAgIG9iamVjdDogJ1VpbnQ4Q2xhbXBlZEFycmF5J1xuICB9LFxuICB7XG4gICAgY2FuaXVzZUlkOiAndHlwZWRhcnJheXMnLFxuICAgIGFzdE5vZGVUeXBlOiAnTmV3RXhwcmVzc2lvbicsXG4gICAgb2JqZWN0OiAnSW50MTZBcnJheSdcbiAgfSxcbiAge1xuICAgIGNhbml1c2VJZDogJ3R5cGVkYXJyYXlzJyxcbiAgICBhc3ROb2RlVHlwZTogJ05ld0V4cHJlc3Npb24nLFxuICAgIG9iamVjdDogJ1VpbnQxNkFycmF5J1xuICB9LFxuICB7XG4gICAgY2FuaXVzZUlkOiAndHlwZWRhcnJheXMnLFxuICAgIGFzdE5vZGVUeXBlOiAnTmV3RXhwcmVzc2lvbicsXG4gICAgb2JqZWN0OiAnSW50MzJBcnJheSdcbiAgfSxcbiAge1xuICAgIGNhbml1c2VJZDogJ3R5cGVkYXJyYXlzJyxcbiAgICBhc3ROb2RlVHlwZTogJ05ld0V4cHJlc3Npb24nLFxuICAgIG9iamVjdDogJ1VpbnQzMkFycmF5J1xuICB9LFxuICB7XG4gICAgY2FuaXVzZUlkOiAndHlwZWRhcnJheXMnLFxuICAgIGFzdE5vZGVUeXBlOiAnTmV3RXhwcmVzc2lvbicsXG4gICAgb2JqZWN0OiAnRmxvYXQzMkFycmF5J1xuICB9LFxuICB7XG4gICAgY2FuaXVzZUlkOiAndHlwZWRhcnJheXMnLFxuICAgIGFzdE5vZGVUeXBlOiAnTmV3RXhwcmVzc2lvbicsXG4gICAgb2JqZWN0OiAnRmxvYXQ2NEFycmF5J1xuICB9XG5dLm1hcChydWxlID0+ICh7XG4gIC4uLnJ1bGUsXG4gIGdldFVuc3VwcG9ydGVkVGFyZ2V0cyxcbiAgaWQ6IHJ1bGUucHJvcGVydHkgPyBgJHtydWxlLm9iamVjdH0uJHtydWxlLnByb3BlcnR5fWAgOiBydWxlLm9iamVjdCxcbiAgcHJvdG9DaGFpbklkOiBydWxlLnByb3BlcnR5ID8gYCR7cnVsZS5vYmplY3R9LiR7cnVsZS5wcm9wZXJ0eX1gIDogcnVsZS5vYmplY3QsXG4gIHByb3RvQ2hhaW46IHJ1bGUucHJvcGVydHkgPyBbcnVsZS5vYmplY3QsIHJ1bGUucHJvcGVydHldIDogW3J1bGUub2JqZWN0XVxufSkpO1xuXG5leHBvcnQgZGVmYXVsdCBDYW5JVXNlUHJvdmlkZXI7XG4iXX0=